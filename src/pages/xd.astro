---
import Layout from "@/layouts/Layout.astro";
---

<Layout title="Memes">
  <div
    id="map"
    class="h-[300px] sm:h-[400px] md:h-[500px] lg:h-[600px] w-full mb-4"
  >
  </div>
</Layout>

<script>
  import L, {
    type LocationEvent,
    type ErrorEventHandlerFn,
    Marker,
  } from "leaflet";

  const map = L.map("map").fitWorld();

  L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution:
      '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
  }).addTo(map);

  let marker: Marker | null = null;
  map.locate({
    setView: true,
    maxZoom: 16,
    watch: true,
    enableHighAccuracy: true,
  });

  let accuracyCircle: L.Circle | null = null;

  function onLocationFound(e: LocationEvent) {
    const radius = e.accuracy;

    if (marker) {
      marker.setLatLng(e.latlng);
    } else {
      marker = L.marker(e.latlng)
        .addTo(map)
        .bindPopup(`You are within ${radius} meters from this point`)
        .openPopup();
    }

    if (accuracyCircle) {
      accuracyCircle.setLatLng(e.latlng).setRadius(radius);
    } else {
      accuracyCircle = L.circle(e.latlng, { radius }).addTo(map);
    }
  }

  const onLocationError: ErrorEventHandlerFn = function (e) {
    alert(e.message);
  };

  map.on("locationfound", onLocationFound);
  map.on("locationerror", onLocationError);
</script>
